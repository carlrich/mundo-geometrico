<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Parejas de √Ångulos</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
  <link rel="shortcut icon" href="./logo.png" type="image/x-icon">
  
  <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/scroll-behaviour.min.js"></script>
  <script>
    MobileDragDrop.polyfill({ dragImageTranslateOverride: MobileDragDrop.scrollBehaviour.scrollBehaviourDragImageTranslateOverride });
  </script>

  <style>
    body { font-family: 'Fredoka', sans-serif; }

    /* Fondo de papel milimetrado */
    .math-bg {
      background-color: #f8fafc;
      background-image: 
        linear-gradient(rgba(148, 163, 184, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(148, 163, 184, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    /* Zonas de Clasificaci√≥n */
    .category-box {
      background: white;
      border: 3px solid;
      border-radius: 16px;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .category-box h2 {
        color: white; padding: 8px 20px; border-radius: 20px; margin-bottom: 10px; font-weight: bold; text-align: center; width: 100%;
    }
    .category-box p { font-size: 0.8rem; color: #64748b; margin-bottom: 10px; text-align: center; }
    
    .category-box.hovered { transform: scale(1.02); box-shadow: 0 10px 15px rgba(0,0,0,0.1); }

    /* Estilos por tipo */
    .cat-comp { border-color: #3b82f6; } .cat-comp h2 { background: #3b82f6; }
    .cat-sup { border-color: #10b981; } .cat-sup h2 { background: #10b981; }
    .cat-ady { border-color: #f59e0b; } .cat-ady h2 { background: #f59e0b; }

    /* Tarjetas de √Ångulos */
    .angle-card {
      width: 160px; height: 140px;
      background: white;
      border: 2px solid #cbd5e1;
      border-radius: 12px;
      margin: 5px;
      cursor: grab;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
      display: flex; justify-content: center; align-items: center;
    }
    .angle-card:active { cursor: grabbing; transform: scale(1.1); }
    .angle-card.placed { width: 100%; height: 120px; border: none; box-shadow: none; cursor: default; }
    .angle-card svg { width: 100%; height: 100%; }

  </style>
</head>

<body class="math-bg min-h-screen flex flex-col items-center p-4">

  <div class="w-full max-w-5xl flex justify-between items-center mb-8 mt-4 bg-white/80 p-4 rounded-2xl shadow-sm backdrop-blur">
    <a href="./index.html" class="text-slate-500 hover:text-blue-600 font-bold flex items-center gap-2">
      ‚¨Ö Salir
    </a>
    <h1 class="text-2xl font-bold text-slate-700">üìê Parejas de √Ångulos</h1>
    <button onclick="window.location.reload()" class="bg-indigo-100 text-indigo-600 px-4 py-2 rounded-xl font-bold hover:bg-indigo-200 transition text-sm">
      üîÑ Nuevas Parejas
    </button>
  </div>

  <div class="w-full max-w-6xl flex flex-col gap-8">
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
      
      <div class="category-box cat-comp drop-zone" data-type="complementario">
        <h2>Complementarios</h2>
        <p>Suman <strong>90¬∞</strong> (Forman una "L")</p>
        <div class="placed-container flex flex-wrap justify-center w-full"></div>
      </div>

      <div class="category-box cat-sup drop-zone" data-type="suplementario">
        <h2>Suplementarios</h2>
        <p>Suman <strong>180¬∞</strong> (L√≠nea recta)</p>
        <div class="placed-container flex flex-wrap justify-center w-full"></div>
      </div>

      <div class="category-box cat-ady drop-zone" data-type="adyacente">
        <h2>Solo Adyacentes</h2>
        <p>Est√°n pegados pero <strong>NO</strong> suman 90¬∞ ni 180¬∞</p>
        <div class="placed-container flex flex-wrap justify-center w-full"></div>
      </div>

    </div>

    <div class="bg-white/90 backdrop-blur-md rounded-3xl p-6 border-4 border-slate-200 shadow-xl">
      <p class="text-center text-slate-400 font-bold uppercase text-xs tracking-widest mb-4">Clasifica las parejas de √°ngulos</p>
      <div id="anglesPool" class="flex flex-wrap justify-center gap-4 min-h-[160px]">
        </div>
    </div>

  </div>

  <script>
    // --- SONIDOS ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
      if (audioCtx.state === 'suspended') audioCtx.resume();
      const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
      osc.connect(gain); gain.connect(audioCtx.destination);
      const now = audioCtx.currentTime;
      if (type === 'pop') {
        osc.frequency.setValueAtTime(400, now); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.1); osc.start(now); osc.stop(now + 0.1);
      } else if (type === 'success') {
        osc.type = 'triangle'; osc.frequency.setValueAtTime(500, now); osc.frequency.linearRampToValueAtTime(800, now + 0.3);
        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.5); osc.start(now); osc.stop(now + 0.5);
      } else if (type === 'error') {
        osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.2); osc.start(now); osc.stop(now + 0.2);
      }
    }

    // --- GENERADOR SVG CORREGIDO Y CENTRADO ---
    function generatePairSVG(angleA, angleB, type) {
      // Dimensiones del lienzo SVG
      const width = 220; 
      const height = 160; 
      
      // El v√©rtice (centro) lo ponemos en la mitad horizontal, y abajo (pero con margen)
      const center = { x: width / 2, y: height - 30 }; 
      const len = 90; // Longitud de las l√≠neas
      
      // Convertir a radianes (SVG coordenadas: Y hacia abajo, por eso negativo)
      const radA = angleA * (Math.PI / 180);
      const radTotal = (angleA + angleB) * (Math.PI / 180);

      // Puntos finales de los rayos
      // Rayo 1 (Base horizontal derecha)
      const p1 = { x: center.x + len, y: center.y };
      // Rayo 2 (Intermedio)
      const p2 = { x: center.x + len * Math.cos(-radA), y: center.y + len * Math.sin(-radA) };
      // Rayo 3 (Final)
      const p3 = { x: center.x + len * Math.cos(-radTotal), y: center.y + len * Math.sin(-radTotal) };

      // Arcos para indicar los √°ngulos
      const arcR = 35; // Radio del arco un poco m√°s grande
      
      // Arco A
      const arcA_start = { x: center.x + arcR, y: center.y };
      const arcA_end = { x: center.x + arcR * Math.cos(-radA), y: center.y + arcR * Math.sin(-radA) };
      // SVG Path comando: M start A rx ry rotation large-arc-flag sweep-flag end
      const pathA = `M ${arcA_start.x} ${arcA_start.y} A ${arcR} ${arcR} 0 0 0 ${arcA_end.x} ${arcA_end.y}`;

      // Arco B
      const arcB_start = arcA_end; // Empieza donde termina A
      const arcB_end = { x: center.x + arcR * Math.cos(-radTotal), y: center.y + arcR * Math.sin(-radTotal) };
      const pathB = `M ${arcB_start.x} ${arcB_start.y} A ${arcR} ${arcR} 0 0 0 ${arcB_end.x} ${arcB_end.y}`;

      // Indicador de √°ngulo recto (cuadradito) si es complementario
      let squareMark = '';
      if (type === 'complementario') {
        const s = 15;
        squareMark = `<path d="M ${center.x+s} ${center.y} L ${center.x+s} ${center.y-s} L ${center.x} ${center.y-s}" fill="none" stroke="#ef4444" stroke-width="2"/>`;
      }

      // Etiquetas de Texto (N√∫meros)
      // Calculamos la posici√≥n en la bisectriz de cada √°ngulo
      const txtRadA = radA / 2;
      const txtRadB = radA + (angleB * (Math.PI/180) / 2);
      const txtDist = 55; // Distancia del texto al centro
      
      const txtA = { x: center.x + txtDist * Math.cos(-txtRadA), y: center.y + txtDist * Math.sin(-txtRadA) };
      const txtB = { x: center.x + txtDist * Math.cos(-txtRadB), y: center.y + txtDist * Math.sin(-txtRadB) };

      // Ajuste para que el texto no quede muy pegado en √°ngulos peque√±os
      const fontSize = 14;

      return `
        <svg viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;">
          <line x1="${center.x}" y1="${center.y}" x2="${p1.x}" y2="${p1.y}" stroke="#334155" stroke-width="3" stroke-linecap="round"/>
          <line x1="${center.x}" y1="${center.y}" x2="${p2.x}" y2="${p2.y}" stroke="#334155" stroke-width="3" stroke-linecap="round"/>
          <line x1="${center.x}" y1="${center.y}" x2="${p3.x}" y2="${p3.y}" stroke="#334155" stroke-width="3" stroke-linecap="round"/>
          
          <circle cx="${center.x}" cy="${center.y}" r="4" fill="#334155" />

          <path d="${pathA}" fill="none" stroke="#3b82f6" stroke-width="2" />
          <path d="${pathB}" fill="none" stroke="#10b981" stroke-width="2" />
          
          ${squareMark}

          <text x="${txtA.x}" y="${txtA.y}" font-family="Fredoka" font-size="${fontSize}" font-weight="bold" fill="#2563eb" text-anchor="middle" dominant-baseline="middle">${angleA}¬∞</text>
          <text x="${txtB.x}" y="${txtB.y}" font-family="Fredoka" font-size="${fontSize}" font-weight="bold" fill="#059669" text-anchor="middle" dominant-baseline="middle">${angleB}¬∞</text>
        </svg>
      `;
    }

    // --- LOGICA DE GENERACI√ìN ---
    let totalCards = 9;
    let placedCount = 0;

    function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function initGame() {
      const pool = document.getElementById("anglesPool");
      pool.innerHTML = ""; placedCount = 0;
      
      const cardsData = [];

      // 1. Generar 3 Complementarios (Suman 90)
      for(let i=0; i<3; i++) {
        const a = getRandomInt(20, 70);
        cardsData.push({ a: a, b: 90-a, type: 'complementario' });
      }

      // 2. Generar 3 Suplementarios (Suman 180)
      for(let i=0; i<3; i++) {
        const a = getRandomInt(30, 150);
        cardsData.push({ a: a, b: 180-a, type: 'suplementario' });
      }

      // 3. Generar 3 Adyacentes "Cualquiera" (No suman 90 ni 180)
      for(let i=0; i<3; i++) {
        let a = getRandomInt(20, 60);
        let b = getRandomInt(20, 60);
        // Evitar que sumen 90 o 180 por accidente
        while (a+b === 90 || a+b === 180) { b = getRandomInt(20, 60); }
        cardsData.push({ a: a, b: b, type: 'adyacente' });
      }

      // Barajar
      cardsData.sort(() => Math.random() - 0.5);

      // Renderizar
      cardsData.forEach((data, index) => {
        const card = document.createElement("div");
        card.className = "angle-card";
        card.draggable = true;
        card.id = `card-${index}`;
        card.dataset.type = data.type;
        
        card.innerHTML = generatePairSVG(data.a, data.b, data.type);

        card.addEventListener("dragstart", e => {
          playSound('pop');
          e.dataTransfer.setData("cardId", card.id);
          e.dataTransfer.setData("type", data.type);
        });
        pool.appendChild(card);
      });

      // Zonas Drop
      document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.addEventListener('dragover', e => {
          e.preventDefault(); zone.classList.add('hovered');
        });
        zone.addEventListener('dragleave', () => zone.classList.remove('hovered'));
        zone.addEventListener('drop', e => handleDrop(e, zone));
      });
    }

    function handleDrop(e, zone) {
      e.preventDefault(); zone.classList.remove('hovered');
      const draggedId = e.dataTransfer.getData("cardId");
      const draggedType = e.dataTransfer.getData("type");
      const targetType = zone.dataset.type;

      if (draggedType === targetType) {
        // CORRECTO
        playSound('success');
        const card = document.getElementById(draggedId);
        card.classList.add('placed');
        card.draggable = false;
        zone.querySelector('.placed-container').appendChild(card);
        
        placedCount++;
        if(placedCount === totalCards) setTimeout(victory, 500);

      } else {
        // INCORRECTO
        playSound('error');
        Swal.fire({
          toast: true, position: 'top', icon: 'error',
          title: '¬°F√≠jate bien en cu√°nto suman!', showConfirmButton: false, timer: 1500
        });
      }
    }

    function victory() {
      confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
      Swal.fire({
        title: "¬°Geometr√≠a Experta! üìêüéì",
        text: "Has clasificado todas las parejas correctamente.",
        icon: "success",
        confirmButtonText: "Jugar de nuevo",
        confirmButtonColor: "#10b981"
      }).then(() => initGame());
    }

    initGame();
  </script>
</body>
</html>