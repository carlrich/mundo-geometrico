<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clasificador de √Ångulos</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
  <link rel="shortcut icon" href="./logo.png" type="image/x-icon">
  
  <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/scroll-behaviour.min.js"></script>
  <script>
    MobileDragDrop.polyfill({ dragImageTranslateOverride: MobileDragDrop.scrollBehaviour.scrollBehaviourDragImageTranslateOverride });
  </script>

  <style>
    body { font-family: 'Fredoka', sans-serif; }

    /* Fondo de papel milimetrado matem√°tico */
    .math-bg {
      background-color: #f0f4f8;
      background-image: 
        linear-gradient(rgba(71, 85, 105, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(71, 85, 105, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    /* Zonas de destino (Contenedores) */
    .category-box {
      background: white;
      border: 3px solid #3b82f6;
      border-radius: 16px;
      min-height: 180px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .category-box h2 {
        background: #3b82f6; color: white; padding: 5px 15px; border-radius: 20px; margin-bottom: 10px; font-weight: bold;
    }
    .category-box.hovered { background-color: #dbeafe; transform: scale(1.02); }
    .category-box.correct { border-color: #22c55e; background-color: #dcfce7; }
    
    /* Estilos espec√≠ficos por categor√≠a */
    .cat-agudo { border-color: #f59e0b; } .cat-agudo h2 { background: #f59e0b; }
    .cat-recto { border-color: #ef4444; } .cat-recto h2 { background: #ef4444; }
    .cat-obtuso { border-color: #8b5cf6; } .cat-obtuso h2 { background: #8b5cf6; }
    .cat-concavo { border-color: #06b6d4; } .cat-concavo h2 { background: #06b6d4; }


    /* Tarjetas de √Ångulos Arrastrables */
    .angle-card {
      width: 140px; height: 140px;
      background: white;
      border: 2px solid #cbd5e1;
      border-radius: 12px;
      margin: 5px;
      cursor: grab;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
      display: flex; justify-content: center; align-items: center;
    }
    .angle-card:active { cursor: grabbing; transform: scale(1.1); }
    .angle-card.placed { width: 100px; height: 100px; border: none; box-shadow: none; margin: 2px; cursor: default; }
    .angle-card svg { width: 100%; height: 100%; }

  </style>
</head>

<body class="math-bg min-h-screen flex flex-col items-center p-4">

  <div class="w-full max-w-5xl flex justify-between items-center mb-8 mt-4 bg-white/80 p-4 rounded-2xl shadow-sm backdrop-blur">
    <a href="../index.html" class="text-slate-500 hover:text-blue-600 font-bold flex items-center gap-2">
      ‚¨Ö Salir
    </a>
    <h1 class="text-2xl font-bold text-slate-700">üìê Clasificador de √Ångulos</h1>
    <button onclick="window.location.reload()" class="bg-blue-100 text-blue-600 px-4 py-2 rounded-xl font-bold hover:bg-blue-200 transition text-sm">
      üîÑ Nuevos √Ångulos
    </button>
  </div>

  <div class="w-full max-w-5xl flex flex-col gap-8">
    
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full">
      <div class="category-box cat-agudo drop-zone" data-type="agudo">
        <h2>Agudo (< 90¬∞)</h2>
        <div class="placed-container flex flex-wrap justify-center"></div>
      </div>
      <div class="category-box cat-recto drop-zone" data-type="recto">
        <h2>Recto (= 90¬∞)</h2>
        <div class="placed-container flex flex-wrap justify-center"></div>
      </div>
      <div class="category-box cat-obtuso drop-zone" data-type="obtuso">
        <h2>Obtuso (> 90¬∞)</h2>
        <div class="placed-container flex flex-wrap justify-center"></div>
      </div>
      <div class="category-box cat-concavo drop-zone" data-type="concavo">
        <h2>C√≥ncavo (> 180¬∞)</h2>
        <div class="placed-container flex flex-wrap justify-center"></div>
      </div>
    </div>

    <div class="bg-white/80 backdrop-blur-md rounded-3xl p-6 border-4 border-slate-200 shadow-xl">
      <p class="text-center text-slate-400 font-bold uppercase text-xs tracking-widest mb-4">Arrastra los √°ngulos a su categor√≠a</p>
      <div id="anglesPool" class="flex flex-wrap justify-center gap-4 min-h-[150px]">
        </div>
    </div>

  </div>

  <script>
    // --- SONIDOS ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
      if (audioCtx.state === 'suspended') audioCtx.resume();
      const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
      osc.connect(gain); gain.connect(audioCtx.destination);
      const now = audioCtx.currentTime;
      if (type === 'pop') {
        osc.frequency.setValueAtTime(400, now); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.1); osc.start(now); osc.stop(now + 0.1);
      } else if (type === 'success') {
        osc.type = 'triangle'; osc.frequency.setValueAtTime(500, now); osc.frequency.linearRampToValueAtTime(800, now + 0.3);
        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.5); osc.start(now); osc.stop(now + 0.5);
      } else if (type === 'error') {
        osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.2); osc.start(now); osc.stop(now + 0.2);
      }
    }

    // --- GENERADOR DE SVG DIN√ÅMICO (La parte matem√°tica) ---
    function generateAngleSVG(degrees) {
      const size = 140; const center = size / 2; const rayLength = size * 0.4;
      const radians = degrees * (Math.PI / 180);
      
      // Punto final del rayo base (horizontal a la derecha)
      const endX1 = center + rayLength; const endY1 = center;
      // Punto final del rayo rotado (usando trigonometr√≠a)
      // Nota: en SVG el eje Y va hacia abajo, por eso restamos el seno
      const endX2 = center + rayLength * Math.cos(-radians);
      const endY2 = center + rayLength * Math.sin(-radians);

      let arcPath = '';
      let textPos = { x: center + 30, y: center - 10 }; // Posici√≥n por defecto texto

      if (degrees === 90) {
        // Dibujar el cuadradito para el √°ngulo recto
        const sqSize = 20;
        arcPath = `M ${center + sqSize} ${center} L ${center + sqSize} ${center - sqSize} L ${center} ${center - sqSize}`;
        textPos = { x: center + 35, y: center - 35 };
      } else {
        // Dibujar el arco para otros √°ngulos
        const arcRadius = rayLength * 0.5;
        const arcStartX = center + arcRadius; const arcStartY = center;
        const arcEndX = center + arcRadius * Math.cos(-radians);
        const arcEndY = center + arcRadius * Math.sin(-radians);
        // Flag de arco grande (para √°ngulos > 180)
        const largeArcFlag = degrees > 180 ? 1 : 0;
        // Comando SVG Path para arco: A rx ry x-axis-rotation large-arc-flag sweep-flag x y
        arcPath = `M ${arcStartX} ${arcStartY} A ${arcRadius} ${arcRadius} 0 ${largeArcFlag} 0 ${arcEndX} ${arcEndY}`;
        
        // Calcular posici√≥n del texto (en la bisectriz)
        const textRad = radians / 2;
        const textDist = arcRadius + 25;
        textPos.x = center + textDist * Math.cos(-textRad);
        textPos.y = center + textDist * Math.sin(-textRad);
      }

      return `
        <svg viewBox="0 0 ${size} ${size}" xmlns="http://www.w3.org/2000/svg">
          <line x1="${center}" y1="${center}" x2="${endX1}" y2="${endY1}" stroke="#334155" stroke-width="1.5" marker-end="url(#arrow)" />
          <line x1="${center}" y1="${center}" x2="${endX2}" y2="${endY2}" stroke="#334155" stroke-width="1.5" marker-end="url(#arrow)" />
          <path d="${arcPath}" fill="none" stroke="#ef4444" stroke-width="2" />
          <text x="${textPos.x}" y="${textPos.y}" font-family="Fredoka, sans-serif" font-size="16" font-weight="bold" fill="#334155" text-anchor="middle" dominant-baseline="middle">${degrees}¬∞</text>
          <defs>
            <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
              <path d="M0,0 L0,6 L9,3 z" fill="#334155" />
            </marker>
          </defs>
        </svg>
      `;
    }

    // --- L√ìGICA DEL JUEGO ---
    let totalAngles = 12; // Cu√°ntos √°ngulos generar
    let placedCount = 0;

    function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function initGame() {
      const pool = document.getElementById("anglesPool");
      pool.innerHTML = ""; placedCount = 0;
      
      // Generar una mezcla de tipos de √°ngulos
      const anglesToGenerate = [];
      // Asegurar al menos uno de cada tipo
      anglesToGenerate.push({ deg: getRandomInt(15, 75), type: 'agudo' });
      anglesToGenerate.push({ deg: 90, type: 'recto' });
      anglesToGenerate.push({ deg: getRandomInt(105, 165), type: 'obtuso' });
      anglesToGenerate.push({ deg: getRandomInt(200, 330), type: 'concavo' });
      
      // Rellenar el resto al azar
      for(let i=4; i<totalAngles; i++) {
        const randType = ['agudo', 'recto', 'obtuso', 'concavo'][getRandomInt(0,3)];
        let deg;
        if(randType === 'agudo') deg = getRandomInt(10, 85);
        else if(randType === 'recto') deg = 90;
        else if(randType === 'obtuso') deg = getRandomInt(95, 175);
        else if(randType === 'concavo') deg = getRandomInt(190, 350);
        anglesToGenerate.push({ deg, type: randType });
      }

      // Barajar
      anglesToGenerate.sort(() => Math.random() - 0.5);

      // Crear las tarjetas
      anglesToGenerate.forEach((angleData, index) => {
        const card = document.createElement("div");
        card.className = "angle-card";
        card.draggable = true;
        card.id = `angle-${index}`;
        card.dataset.type = angleData.type;
        // AQU√ç SE GENERA EL SVG DIN√ÅMICO
        card.innerHTML = generateAngleSVG(angleData.deg);

        card.addEventListener("dragstart", e => {
          playSound('pop');
          e.dataTransfer.setData("cardId", card.id);
          e.dataTransfer.setData("type", angleData.type);
        });
        pool.appendChild(card);
      });

      // Configurar zonas de drop
      document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.addEventListener('dragover', e => {
          e.preventDefault(); zone.classList.add('hovered');
        });
        zone.addEventListener('dragleave', () => zone.classList.remove('hovered'));
        zone.addEventListener('drop', e => handleDrop(e, zone));
      });
    }

    function handleDrop(e, zone) {
      e.preventDefault(); zone.classList.remove('hovered');
      const draggedId = e.dataTransfer.getData("cardId");
      const draggedType = e.dataTransfer.getData("type");
      const targetType = zone.dataset.type;

      if (draggedType === targetType) {
        // CORRECTO
        playSound('success');
        const originalCard = document.getElementById(draggedId);
        originalCard.classList.add('placed');
        originalCard.draggable = false;
        // Mover al contenedor interno de la zona
        zone.querySelector('.placed-container').appendChild(originalCard);
        placedCount++;
        if(placedCount === totalAngles) setTimeout(victory, 500);
      } else {
        // INCORRECTO
        playSound('error');
        Swal.fire({ toast: true, position: 'top', icon: 'error', title: '¬°Ups! Ese no va ah√≠.', showConfirmButton: false, timer: 1000 });
      }
    }

    function victory() {
      confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
      Swal.fire({
        title: "¬°Geometr√≠a Dominada! üìê‚ú®",
        text: "Has clasificado todos los √°ngulos correctamente.",
        icon: "success",
        confirmButtonText: "Jugar de nuevo",
        confirmButtonColor: "#3b82f6"
      }).then(() => initGame());
    }

    initGame();
  </script>
</body>
</html>